{% extends "pages/base.html" %}

{% block title %}
<title>Login</title>
<meta property='og:title' content='Login to FeatureBase AI'/>
{% endblock %}

{% block content %}

<div class="container">
  <div class="row">
    <div class="col-sm-3">
    </div>
    <div class="col-sm-6">
      <div class="login_form">
        <div style="display: flex; align-items: center;">
          <img src="/static/fb.png" style="height: 2.0rem; width: auto; margin-right: 10px;"> 
          <h2 style="font-family: Roboto,sans-serif; color: #ffffff; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); margin: 0;">FeatureBase AI</h2>
        </div>

        <p class="lead">Connect your database to cool AI models.</p>

        <form autocomplete="off" id="{{app_id}}" action="/login" method="post">
          <div class="form-group">
            <label>Your <a href="https://cloud.featurebase.com/databases" target=_blank>Database ID</a>...</label>
            <input autofocus name="dbid" id="dbid-{{app_id}}" type="text" class="form-control" placeholder="1ba4db82-aee7-4e6d-8688-e8620c3e0bfd">
            <label>Your <a href="https://cloud.featurebase.com/configuration/api-keys" target=_blank>API token</a>...</label>
            <input name="token" id="token-{{app_id}}" type="text" class="form-control" placeholder="f0bb344f-79ca-4e48-8f3d-e236f29f8bac">
            <label id="password_label">Your password is required...</label>
            <input id="password" type="password" class="form-control" name="password" placeholder="************">
            {% if next %}
            <input type="hidden" name="next" value="{{next}}">
            {%endif%}
            <input type="hidden" name="transaction_id" value="{{transaction_id}}">
            <small class="form-text text-muted">
              {% for message in get_flashed_messages() %}
              <div class="flash">{{ message }}</div>
              {% endfor %}
            </small>
          </div>
          <button type="submit" class="btn btn-primary" title="Verify your token.">Authenticate</button>
          <a href="/" class="btn btn-outline-dark" title="Leave this place.">Cancel</a>
        </form>
      </div>
    </div>
    <div class="col-sm-3">
    </div>
  </div>
</div>

{% endblock %}

{% block footer %}
{% endblock %}

{% block javascript %}
<script src="{{ url_for('static', filename='trianglify.bundle.js') }}"></script>
<script type="text/javascript">
$(document).ready(function() {
  $(window).keydown(function(event){
    if(event.keyCode == 13) {
      console.log("default triggered");
      $("{{app_id}}").submit();
      prevent = setTimeout(function() {
        event.preventDefault();
      }, 1000);
    }
  });

  function generateGradient(startColor, endColor, steps) {
      let start = {
          'r': parseInt(startColor.slice(1, 3), 16),
          'g': parseInt(startColor.slice(3, 5), 16),
          'b': parseInt(startColor.slice(5, 7), 16)
      };

      let end = {
          'r': parseInt(endColor.slice(1, 3), 16),
          'g': parseInt(endColor.slice(3, 5), 16),
          'b': parseInt(endColor.slice(5, 7), 16)
      };

      let diff = {
          'r': end.r - start.r,
          'g': end.g - start.g,
          'b': end.b - start.b
      };

      let stepsHex = [];

      for (let i = 0; i <= steps; i++) {
          let r = Math.round(start.r + (diff.r / steps) * i).toString(16).padStart(2, '0');
          let g = Math.round(start.g + (diff.g / steps) * i).toString(16).padStart(2, '0');
          let b = Math.round(start.b + (diff.b / steps) * i).toString(16).padStart(2, '0');

          stepsHex.push(`#${r}${g}${b}`);
      }

      return stepsHex;
  }

  let gradient = generateGradient("#ffffff", "#291c6a", 255);

  function tri() {
    // Create the Trianglify pattern
    const pattern = trianglify({
      width: window.innerWidth,
      height: window.innerHeight,
      xColors: gradient,
      yColors: 'match'
    });

    // Serialize the SVG object to a String
    var m = new XMLSerializer().serializeToString(pattern.toSVG());

    // Perform the base64 encoding of the String
    var k = window.btoa(m);

    // hack the colorization of the fields
    $('#password').remove();
    $('#password_label').remove();

    // Set the background image property, including the encoding type header
    $("body").css("background-image", 'url("data:image/svg+xml;base64,' + k + '")');
  }

  // build and maintain image background
  tri();
  $(window).resize(function() {
    tri();
  });
});
</script>
{% endblock %}